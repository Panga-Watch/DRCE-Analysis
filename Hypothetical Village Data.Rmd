---
title: "Hypothetical Village Data"
author: "Gage Clawson"
date: "1/16/2020"
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
library(tidyverse)
library(mefa)

total_sim_data <- read_csv("output/lm_15_allcombo_predictions.csv") %>%
  select(-X1)

set.seed(6969)

```

```{r}
# load necessary packages for importing the function
library(RCurl)
 
# import the function from repository
url_robust <- "https://raw.githubusercontent.com/IsidoreBeautrelet/economictheoryblog/master/robust_summary.R"
eval(parse(text = getURL(url_robust, ssl.verifypeer = FALSE)))
```

Puerto San Carlos; Based off of Jumbo Squid Fishery.
Paper: [Socioeconomic Diagnosis of the 2010 Jumbo Squid Artisanal Fishery near Magdalena Bay, Baja California Sur, Mexico](http://www.scielo.org.mx/scielo.php?script=sci_arttext&pid=S0188-88972014000100002)

Statistics: 
 - Population 5538 (2010 census data)
 - Artisanal Fisheries employ about 50% of the working population. 
 - 1800 fishing permits for jumbo squid 
   - "almost all of our respondents engage in other fisheries when jumbo squid are not present"
   - Assume that there are 1800 fishers in Puerto San Carlos. 
 - Average age is 34 years with a range of 18 to 78. 
 - No formal education (34%); formal (middle or high school; 30% + 33% = 63%); classify the remaining as higher (3%)
 - average of $11,090 Mexican Pesos each month (+/- $1,000 USD per month)
 - Assume biggest problem for the fishery is IUU. 
 - 8% did not have fishing communication technology on their boat. 

```{r}

# fishtech_yes <- 1800*0.92
# fishtech_no <- 1800*0.08
# 
# no_formal_edu <- 1800*0.34
# formal_edu <- 1800*0.63
# higher_edu <- 1800*0.03
# 
# iuu <- 1800
# 
# psc_filter <- total_sim_data %>%
#   filter(rank_one == "iuu", sos == 1, info == 0, own == 1)
wtpmin <- -5.35

fishtech <- c(0,1)
psc_prob_fishtech <- c(0.08, 0.92)
rank_one <- c("corruption", "pollution", "weather", "iuu")
education <- c("no_formal", "formal", "higher")
psc_prob_edu <- c(0.34, 0.63, 0.03)

psc <- data.frame(
                  fishtech = sample(rep(fishtech, round(1800*psc_prob_fishtech))),
                  education = sample(rep(education, round(1800*psc_prob_edu))),
                  rank_one = "iuu"
                  )



length(psc$fishtech[psc$fishtech ==0]) # this should be 144 !!!?
length(psc$fishtech[psc$fishtech ==1])

length(psc$education[psc$education == "no_formal"])
length(psc$education[psc$education == "formal"])
length(psc$education[psc$education == "higher"])

length(psc$rank_one[psc$rank_one == "iuu"])



sos <- c(0,1)
info <- c(0,1)
own <- c("1", "2", "3", "4")

packages <- expand.grid(sos = sos,info = info, own= own)

# new <- merge(psc,packages)
# new_filter <- new %>%
#   filter(sos == 1, info == 0, own == 1)
# 
# length(new_filter$education[new_filter$education == "no_formal"]) #612
# length(psc$rank_one[psc$rank_one == "iuu"]) #1800
# length(psc$fishtech[psc$fishtech == 1]) #1656
# ## IT WORKS!! 


psc_all_packages <- merge(psc, packages)

#write.csv(psc_all_packages, "hypo_village_data/PuertoSanCarlos.csv", row.names = FALSE)

## load in specific model 
load("output/lm_15.rda")

psc_predict <- data.frame(psc_all_packages, lm_15_wtp = exp(predict(wtp_lm_15, newdata = psc_all_packages)) - 1 + wtpmin) ## if you want to add predictions from another model, just tack it onto the end. Now we can filter for a technology and make graphs based off of that. 

#write.csv(psc_predict, "hypo_village_data/PuertoSanCarlos_predictions.csv", row.names = FALSE)

test <- psc_predict %>%
  filter(sos == 1, info == 0, own == 1)

test_2 <- psc_predict %>%
  filter(sos == 1, info == 1, own == 4)

test_3 <- psc_predict %>%
  filter(sos == 0, info == 1, own == 4)
```

